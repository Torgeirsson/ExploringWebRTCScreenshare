(this.webpackJsonpwebrtc_connect=this.webpackJsonpwebrtc_connect||[]).push([[0],{37:function(e,t,n){e.exports=n(81)},42:function(e,t,n){},44:function(e,t,n){},76:function(e,t){},79:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var a,r,c,o,i,l,s,u,m=n(0),d=n.n(m),f=n(33),p=n.n(f),b=(n(42),n(1)),g=(n(43),n(44),n(36)),v=n(2),E=n.n(v),h=n(6),O=n(34),j=n.n(O),k=(n(79),function(e){var t=Object(m.useState)(0),n=Object(b.a)(t,2),c=n[0],o=n[1],i=Object(m.useState)(0),l=Object(b.a)(i,2),s=l[0],u=l[1],f=e.pcs[e.id];return Object(m.useEffect)((function(){r=f.getSenders()[0]}),[]),function(e,t){var n=Object(m.useRef)();Object(m.useEffect)((function(){n.current=e}),[e]),Object(m.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){f&&r?r.getStats().then((function(e){e.forEach((function(e){if("transport"===e.type&&a&&a.has(e.id)){var t=(e.timestamp-a.get(e.id).timestamp)/1e3,n=8*(e.bytesSent-a.get(e.id).bytesSent)/t/1e5,r=8*(e.bytesReceived-a.get(e.id).bytesReceived)/t/1e5;o(n.toFixed(2)),u(r.toFixed(2))}})),a=e})):console.log("return",f,r)}),1e3),d.a.createElement("div",null,d.a.createElement("div",null,d.a.createElement("p",null,"Bitrate utg\xe5ende: ",c," Mbit/s | Bitrate inkommande: ",s," Mbit/s ")))}),y=function(e){var t=e.stream,n=e.style,a=e.users,r=e.pcs,c=Object(m.useState)(""),o=Object(b.a)(c,2),i=o[0],l=o[1],s=Object(m.useState)(!0),u=Object(b.a)(s,2),f=u[0];u[1];Object(m.useEffect)((function(){p.current.srcObject=t.video,p.current.controls=!0,l(a.filter((function(e){return e[0]==t.socketid}))[0][1].name)}),[i]);var p=Object(m.useRef)();return d.a.createElement("div",{className:f?"visibile":"invisible"},d.a.createElement("h1",null,"Video fr\xe5n ",i),d.a.createElement("video",{ref:p,style:n,autoPlay:!0}),d.a.createElement(k,{pcs:r,id:t.socketid}))},w=(n(80),{iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),N={},S=function(e){var t=e.loginName,n=e.room,a=(e.peersInRoom,e.setPeersInRoom),r=Object(m.useState)([]),f=Object(b.a)(r,2),p=f[0],v=f[1],O=Object(m.useState)(!1),k=Object(b.a)(O,2),S=k[0],x=k[1],R=Object(m.useState)({}),C=Object(b.a)(R,2),D=C[0],I=C[1];Object(m.useEffect)((function(){(c=j()("https://agile-headland-95579.herokuapp.com/")).on("connect",(function(){console.log("connected",t,n),c.emit("name-and-room",{name:t,room:n})})),c.on("localID",(function(e){s=e})),c.on("name-update",(function(e){I(e);var t=[];Object.entries(e).forEach((function(e){t.push(e[1].name)})),a(e)}));var e=function(e,t){c.emit(e,t)},r=function(t,n){return t.onnegotiationneeded=Object(h.a)(E.a.mark((function a(){return E.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("negotiationneeded"),u=!0,a.next=4,t.setLocalDescription(t.createOffer());case 4:t.localDescription&&(console.log("sending offer",t.localDescription),e("payload",{payload:t.localDescription,remoteid:s,target:n,type:"offer"})),u=!1;case 6:case"end":return a.stop()}}),a)}))),t.onicecandidate=function(t){t&&t.candidate&&e("payload",{payload:t.candidate,type:"ice",remoteid:s,target:n})},t.oniceconnectionstatechange=function(e){"failed"===t.iceConnectionState&&t.restartIce()},t.ontrack=function(){var e=Object(h.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("track",t),t.track.onunmute=Object(h.a)(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v((function(e){return e.filter((function(e){return!(e.socketid===n)}))}));case 2:return e.next=4,v((function(e){return[].concat(Object(g.a)(e),[{socketid:n,video:t.streams[0]}])}));case 4:case"end":return e.stop()}}),e)})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i&&(console.log("stream",i),i.getTracks().forEach((function(e){return t.addTrack(e,i)}))),N[n]=t,t};o=function(){navigator.mediaDevices.getDisplayMedia().then((function(e){i&&i.getTracks().forEach((function(e){e.stop()})),T&&T.current.srcObject&&T.current.srcObject.getTracks().forEach((function(e){return e.stop})),e.oninactive=function(e){console.log("inactive",e),x(!1)},T.current.srcObject=e,i=e,c.emit("active-sender"),x(!0)}))},c.on("want-to-watch",function(){var e=Object(h.a)(E.a.mark((function e(t){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N[t]){e.next=9;break}return console.log("creating"),e.next=4,r(new RTCPeerConnection(w),t);case 4:n=e.sent,console.log("want to watch from",t),N[t]=n,e.next=12;break;case 9:console.log("not creating"),n=N[t],i&&(i.getTracks().forEach((function(e){return e.enabled=!0})),i.getTracks().forEach((function(e){try{n.addTrack(e,i)}catch(t){console.log(t)}})));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.on("payload",function(){var t=Object(h.a)(E.a.mark((function t(n){return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(N[n.remoteid]){t.next=7;break}return t.next=3,r(new RTCPeerConnection(w),n.remoteid);case 3:l=t.sent,N[n.remoteid]=l,t.next=8;break;case 7:l=N[n.remoteid];case 8:if("offer"!==n.type){t.next=17;break}if(!(s>n.remoteid)||!u&&"stable"==l.signalingState){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,l.setRemoteDescription(n.payload);case 13:return t.next=15,l.setLocalDescription();case 15:console.log("sending answer",l.localDescription,s),e("payload",{payload:l.localDescription,remoteid:s,type:"answer",target:n.remoteid});case 17:"answer"===n.type&&(console.log("got answer",n),l.setRemoteDescription(new RTCSessionDescription(n.payload))),"ice"===n.type&&l.addIceCandidate(new RTCIceCandidate(n.payload));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),c.on("call-started",(function(){console.log("call started"),c.emit("want-to-watch")})),c.on("hangup",(function(e){console.log("hung up")})),c.on("peer-left",(function(e){v((function(t){return t.filter((function(t){return t.socketid!=e}))}))}))}),[]);var T=Object(m.useRef)(),P=(Object(m.useRef)(),{width:"100%",height:"auto",margin:5,backgroundColor:"black"});return d.a.createElement("div",{className:"App"},d.a.createElement("h1",null,"WebRTC Media sharing"),d.a.createElement("h3",null,'Rum: "',n,'"'),d.a.createElement("div",{className:"VideoContainer"},d.a.createElement("video",{className:"Video",style:P,ref:T,autoPlay:!0}),d.a.createElement("p",null,"Din egen bild du visar")),d.a.createElement("br",null),S?d.a.createElement("button",{class:"btn btn-warning",onClick:function(){return c.emit("hangup"),T.current.srcObject.getTracks()[0].enabled=!1,void x(!1)}},"Pausa"):d.a.createElement("button",{class:"btn btn-primary",onClick:function(){return o()}},"Share my Screen"),d.a.createElement("hr",null),p.map((function(e,t){return d.a.createElement(y,{key:t,stream:e,style:P,users:D,pcs:N})})))},x=function(e){var t=e.peersInRoom;return d.a.createElement("div",{className:"bg-light border-right",id:"sidebar-wrapper"},d.a.createElement("br",null),d.a.createElement("div",{className:"sidebar-heading"},"Anslutna i rummet:"),d.a.createElement("div",null),d.a.createElement("div",{id:"sidebarContent"},t.map((function(e){return d.a.createElement("div",null,d.a.createElement("h4",null,e[1].name))}))))},R=function(e){return d.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},d.a.createElement("a",{className:"navbar-brand",href:"#"},"Sk\xe4rmdelningsapp 3000"),d.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},d.a.createElement("span",{className:"navbar-toggler-icon"})),d.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},d.a.createElement("ul",{className:"navbar-nav mr-auto"},d.a.createElement("li",{className:"nav-item active"},d.a.createElement("a",{className:"nav-link",href:"#"},"Home ",d.a.createElement("span",{class:"sr-only"},"(current)"))),d.a.createElement("li",{className:"nav-item"},d.a.createElement("a",{className:"nav-link disabled",href:"#"},"Disabled")))))},C=function(e){var t=e.setLoggedIn,n=e.setName,a=e.setRoom,r=Object(m.useState)(""),c=Object(b.a)(r,2),o=c[0],i=c[1],l=Object(m.useState)(""),s=Object(b.a)(l,2),u=s[0],f=s[1];return d.a.createElement("div",{style:{margin:"auto",marginTop:"50px",width:"60%",padding:"10px"}},d.a.createElement("h2",null,"V\xe4lkommen till sk\xe4rmdelningsappen"),d.a.createElement("form",{onSubmit:function(e){e.preventDefault(),o&&u&&(n(o),a(u),t(!0))}},d.a.createElement("br",null),d.a.createElement("input",{className:"form-control mr-sm-2",type:"name",placeholder:"Namn","aria-label":"Name",value:o,onChange:function(e){i(e.target.value)}}),d.a.createElement("br",null),d.a.createElement("input",{className:"form-control mr-sm-2",type:"Room",placeholder:"Skriv in ett rum att ansluta till","aria-label":"Room",value:u,onChange:function(e){f(e.target.value)}}),d.a.createElement("br",null),d.a.createElement("button",{type:"submit",className:"btn-primary"},"Enter")))},D=function(){var e=Object(m.useState)(!1),t=Object(b.a)(e,2),n=t[0],a=t[1],r=Object(m.useState)(""),c=Object(b.a)(r,2),o=c[0],i=c[1],l=Object(m.useState)(""),s=Object(b.a)(l,2),u=s[0],f=s[1],p=Object(m.useState)([]),g=Object(b.a)(p,2),v=g[0],E=g[1];return d.a.createElement("div",{className:"container-fluid"},d.a.createElement(R,null),d.a.createElement("div",{className:"row"},d.a.createElement("div",{id:"sidebar-wrapper",className:"col-2"},d.a.createElement(x,{peersInRoom:v})),d.a.createElement("div",{id:"content-wrapper",className:"col-7"},d.a.createElement("div",{id:"main-area",className:"container-fluid"},n?d.a.createElement(S,{loginName:o,room:u,peersInRoom:v,setPeersInRoom:E}):d.a.createElement(C,{setLoggedIn:a,setName:i,setRoom:f})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));p.a.render(d.a.createElement(d.a.StrictMode,null,d.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[37,1,2]]]);
//# sourceMappingURL=main.9d5692c3.chunk.js.map